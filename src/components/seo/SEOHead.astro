---
/**
 * Comprehensive SEO Head Component for SECiD Platform
 * Implements all essential SEO meta tags, structured data, and accessibility features
 */

interface Props {
  title?: string;
  description?: string;
  keywords?: string[];
  lang?: 'es' | 'en';
  ogImage?: string;
  ogType?: 'website' | 'article' | 'profile' | 'video' | 'book';
  author?: string;
  publishedTime?: string;
  modifiedTime?: string;
  section?: string;
  tags?: string[];
  canonicalUrl?: string;
  noindex?: boolean;
  nofollow?: boolean;
  structuredData?: Record<string, any>;
  alternateLinks?: Array<{ href: string; hreflang: string }>;
  breadcrumbs?: Array<{ name: string; url: string }>;
  jobPosting?: any;
  event?: any;
  organization?: any;
}

const {
  title = 'SECiD - Sociedad de Egresados en Ciencia de Datos UNAM',
  description = 'Conectando egresados en ciencia de datos de la UNAM. Oportunidades laborales, networking y crecimiento profesional.',
  keywords = [
    'ciencia de datos',
    'UNAM',
    'egresados',
    'empleo',
    'networking',
    'data science',
    'universidad',
  ],
  lang = 'es',
  ogImage = '/images/logo.png',
  ogType = 'website',
  author = 'SECiD UNAM',
  publishedTime,
  modifiedTime,
  section,
  tags = [],
  canonicalUrl,
  noindex = false,
  nofollow = false,
  structuredData,
  alternateLinks = [],
  breadcrumbs = [],
  jobPosting,
  event,
  organization,
} = Astro.props;

// Generate canonical URL
const currentUrl =
  canonicalUrl || new URL(Astro.url.pathname, Astro.site).toString();

// Create alternate language links
const defaultAlternateLinks = [
  { href: currentUrl.replace('/es/', '/en/'), hreflang: 'en' },
  { href: currentUrl.replace('/en/', '/es/'), hreflang: 'es' },
  {
    href: currentUrl.replace('/en/', '/').replace('/es/', '/'),
    hreflang: 'x-default',
  },
];

const allAlternateLinks =
  alternateLinks.length > 0 ? alternateLinks : defaultAlternateLinks;

// Robots meta content
let robotsContent = 'index, follow';
if (noindex && nofollow) {
  robotsContent = 'noindex, nofollow';
} else if (noindex) {
  robotsContent = 'noindex, follow';
} else if (nofollow) {
  robotsContent = 'index, nofollow';
}

// Generate structured data for organization
const defaultOrganization = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'SECiD - Sociedad de Egresados en Ciencia de Datos UNAM',
  description:
    'Sociedad de egresados en ciencia de datos de la Universidad Nacional Autónoma de México',
  url: 'https://secid.mx',
  logo: 'https://secid.mx/images/logo.png',
  sameAs: [
    'https://www.linkedin.com/company/secid-unam',
    'https://twitter.com/secid_unam',
    'https://www.facebook.com/secid.unam',
  ],
  contactPoint: {
    '@type': 'ContactPoint',
    telephone: '+52-55-5622-5000',
    contactType: 'customer service',
    availableLanguage: ['Spanish', 'English'],
  },
  address: {
    '@type': 'PostalAddress',
    addressCountry: 'MX',
    addressLocality: 'Ciudad de México',
    addressRegion: 'CDMX',
  },
};

// Generate breadcrumb structured data
const breadcrumbStructuredData =
  breadcrumbs.length > 0
    ? {
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: breadcrumbs.map((item, index) => ({
          '@type': 'ListItem',
          position: index + 1,
          name: item.name,
          item: new URL(item.url, Astro.site).toString(),
        })),
      }
    : null;

// Generate job posting structured data
const jobPostingStructuredData = jobPosting
  ? {
      '@context': 'https://schema.org',
      '@type': 'JobPosting',
      title: jobPosting.title,
      description: jobPosting.description,
      hiringOrganization: {
        '@type': 'Organization',
        name: jobPosting.company,
        sameAs: jobPosting.companyUrl,
      },
      jobLocation: {
        '@type': 'Place',
        address: {
          '@type': 'PostalAddress',
          addressLocality: jobPosting.location,
          addressCountry: jobPosting.country || 'MX',
        },
      },
      employmentType: jobPosting.employmentType,
      datePosted: jobPosting.datePosted,
      validThrough: jobPosting.validThrough,
      baseSalary: jobPosting.salary
        ? {
            '@type': 'MonetaryAmount',
            currency: jobPosting.currency || 'MXN',
            value: {
              '@type': 'QuantitativeValue',
              value: jobPosting.salary,
              unitText: 'MONTH',
            },
          }
        : undefined,
    }
  : null;

// Generate event structured data
const eventStructuredData = event
  ? {
      '@context': 'https://schema.org',
      '@type': 'Event',
      name: event.name,
      description: event.description,
      startDate: event.startDate,
      endDate: event.endDate,
      location: {
        '@type': 'Place',
        name: event.location,
        address: event.address,
      },
      organizer: {
        '@type': 'Organization',
        name: 'SECiD UNAM',
      },
      eventStatus: 'https://schema.org/EventScheduled',
      eventAttendanceMode: event.isOnline
        ? 'https://schema.org/OnlineEventAttendanceMode'
        : 'https://schema.org/OfflineEventAttendanceMode',
    }
  : null;

// Combine all structured data
const allStructuredData = [
  organization || defaultOrganization,
  breadcrumbStructuredData,
  jobPostingStructuredData,
  eventStructuredData,
  structuredData,
].filter(Boolean);
---

<!-- Essential Meta Tags -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content={description} />
<meta name="keywords" content={keywords.join(', ')} />
<meta name="author" content={author} />
<meta name="robots" content={robotsContent} />
<meta name="googlebot" content={robotsContent} />

<!-- Page Title -->
<title>{title}</title>

<!-- Canonical URL -->
<link rel="canonical" href={currentUrl} />

<!-- Language Alternates -->
{
  allAlternateLinks.map((link) => (
    <link rel="alternate" hreflang={link.hreflang} href={link.href} />
  ))
}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={currentUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={new URL(ogImage, Astro.site)} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content={lang === 'es' ? 'es_MX' : 'en_US'} />
<meta property="og:site_name" content="SECiD UNAM" />

{
  ogType === 'article' && (
    <>
      {author && <meta property="article:author" content={author} />}
      {publishedTime && (
        <meta property="article:published_time" content={publishedTime} />
      )}
      {modifiedTime && (
        <meta property="article:modified_time" content={modifiedTime} />
      )}
      {section && <meta property="article:section" content={section} />}
      {tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))}
    </>
  )
}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@secid_unam" />
<meta name="twitter:creator" content="@secid_unam" />
<meta name="twitter:url" content={currentUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={new URL(ogImage, Astro.site)} />
<meta name="twitter:image:alt" content={`${title} - SECiD UNAM`} />

<!-- Additional SEO Meta Tags -->
<meta name="theme-color" content="#F65425" />
<meta name="msapplication-TileColor" content="#F65425" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="SECiD" />

<!-- Favicon and App Icons -->
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/images/favicon-32x32.png"
/>
<link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/icon.png" />

<!-- Web App Manifest -->
<link rel="manifest" href="/manifest.json" />

<!-- DNS Prefetch for Performance -->
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel="dns-prefetch" href="//cdn.amplitude.com" />

<!-- Preconnect to Critical Resources -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Security Headers -->
<meta http-equiv="X-Content-Type-Options" content="nosniff" />
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
<meta http-equiv="X-XSS-Protection" content="1; mode=block" />
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

<!-- Structured Data (JSON-LD) -->
{
  allStructuredData.map((data) => (
    <script type="application/ld+json" set:html={JSON.stringify(data)} />
  ))
}

<!-- Language and Accessibility -->
<html lang={lang}></html>

<!-- Accessibility: Skip Navigation -->
<style>
  .skip-link {
    position: absolute;
    left: -9999px;
    z-index: 999;
    padding: 8px 16px;
    background: #000;
    color: #fff;
    text-decoration: none;
    border-radius: 0 0 8px 0;
  }

  .skip-link:focus {
    left: 6px;
    top: 6px;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    :root {
      --contrast-bg: #000;
      --contrast-text: #fff;
      --contrast-border: #fff;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* Focus management */
  .focus-trap {
    outline: 2px solid #f65425;
    outline-offset: 2px;
  }
</style>

<!-- Accessibility: Skip Navigation Link -->
<a href="#main-content" class="skip-link">
  {lang === 'es' ? 'Saltar al contenido principal' : 'Skip to main content'}
</a>
